<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display+SC&display=swap"
      rel="stylesheet"
    /> -->
    <title>SuperAmazingAwesomeApp</title>


  </head>
  <body>
    <script>
      // Function to get the Selected Text 
      function getSelectedText() {
        let selectedText = '';

        // window.getSelection
        if (window.getSelection) {
            selectedText = window.getSelection();
        }
        // document.getSelection
        else if (document.getSelection) {
            selectedText = document.getSelection();
        }
        // document.selection
        else if (document.selection) {
            selectedText = 
            document.selection.createRange().text;
        } else return;

        selectedText = selectedText.toString().trim();

        // IF NONE SELECTED, USE ALL
        if (selectedText === '') {
          selectedText = document.getElementById("ta1").value; 
        }

        const arrItems = matchRecursiveRegExp (selectedText, '{', '}');

        let myQuery = 'query myquery {\r\n';
        for (let i = 0; i < arrItems.length; i++){
          myQuery += arrItems[i].trim() + (i < arrItems.length - 1 ? ',\r\n' : '\r\n');
        }
        myQuery += '}';

        document.testform.selectedtext.value = myQuery;
      }


      function matchRecursiveRegExp (str, left, right) {
        const x = new RegExp(left + "|" + right, "g")
        const l = new RegExp(left)
        let a = []
        let t, s, m

        t = 0;
        
        while (m = x.exec(str)) {

          if (l.test(m[0])) {
            if (!t++) {
              s = x.lastIndex;
            }
          } else if (t) {
            if (!--t) {
              a.push(str.slice(s, m.index));
            }
          }

        }
        return a;
      }

      //console.log(matchRecursiveRegExp('query secondQuery {  books {    name    id  }} query thirdQuery {  authors {    name  }}', '{', '}'));


      // console.log(matchRecursiveRegExp('query HeroNameAndFriends {  hero {    name    friends {      name    }  }}', '{', '}'));
    </script>
    
    <textarea id="ta1" name="w3review" rows="40" cols="100"></textarea>

    <input type="button" value="Get Selection"  onmousedown="getSelectedText()">
        
    <!--Form to show the selected text as output-->
    <form name="testform">
        <textarea name="selectedtext" 
                  rows="20"
                  cols="100"></textarea>
    </form>


    <div id="root"></div>
    <script src="build/bundle.js"></script>
    <!-- <script src="index.js"></script> -->
  </body>
</html>